
{% extends "base_template.html" %}
{% block title %}Top Datasets{% endblock %}

{% block content %}
<h1 class="h3 mb-3">
  Top {{ 'most viewed' if metric == 'views' else 'most downloaded' }} datasets
</h1>

<form id="filterForm" method="get"
      action="{{ url_for('dataset.view_top_global') }}"
      class="mb-4 d-flex flex-wrap gap-2 align-items-center">

  <!-- M√©trica -->
  <div class="btn-group">
    <button type="submit" name="metric" value="downloads"
            class="btn btn-outline-primary {% if metric == 'downloads' %}active{% endif %}">
      Most downloaded
    </button>
    <button type="submit" name="metric" value="views"
            class="btn btn-outline-primary {% if metric == 'views' %}active{% endif %}">
      Most viewed
    </button>
  </div>

  <!-- Rango -->
  <div class="btn-group">
    <button type="submit" name="days" value="7"
            class="btn btn-outline-secondary {% if days == 7 %}active{% endif %}">
      Last 7 days
    </button>
    <button type="submit" name="days" value="30"
            class="btn btn-outline-secondary {% if days == 30 %}active{% endif %}">
      Last 30 days
    </button>
  </div>

  <!-- Limit -->
  <div class="input-group" style="width: 140px;">
    <input type="number" class="form-control text-center"
           name="limit" value="{{ limit }}" min="1">
  </div>

  <input type="hidden" name="metric" value="{{ metric }}">
  <input type="hidden" name="days" value="{{ days }}">
</form>

{% if datasets %}
  <div class="d-flex flex-column gap-3">
    {% for d in datasets %}
      <div class="card shadow-sm w-100">
        <div class="card-body d-flex justify-content-between align-items-center flex-wrap">

          <!-- Left: Title -->
          <div class="me-3">
            <h5 class="mb-1">{{ d.title }}</h5>
            <small class="text-muted">
              {% if metric == 'views' %}
                üëÅ {{ d.views }} views
              {% else %}
                ‚¨á {{ d.downloads }} downloads
              {% endif %}
            </small>
          </div>

          <!-- Right: Action -->
          <div>
            {% if metric == 'views' %}
              <a href="{{ url_for('dataset.subdomain_index', doi=d.doi) }}"
                 class="btn btn-outline-primary btn-sm">
                <i data-feather="eye"></i> View dataset
              </a>
            {% else %}
              <a href="{{ url_for('dataset.download_dataset', dataset_id=d.dataset_id) }}"
                 class="btn btn-outline-success btn-sm">
                <i data-feather="download"></i> Download CSV
              </a>
            {% endif %}
          </div>

        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-info">
    No datasets found.
  </div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function () {
  if (typeof feather !== 'undefined') {
    feather.replace();
  }
});
</script>

{% endblock %}
